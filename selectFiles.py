import shutil, csv, os

datasetDetails = "/home/sparknode/IdeaProjects/DetectMalware/DatasetDetails.csv" 
datasetPath = "/media/sparknode/0552ca8f-5c83-439b-bdb7-5d88a272f2b5/Lab Machine Backup/Malware Data Collection/Data/Kaggle-microsoft-malware-data/train/train"
outputPath = "/home/sparknode/selected-input-100"


def writeCSV(filename, label):
	with open("metadata.csv", 'a') as output:
		print "inside writeCSV"
		CSVwriter = csv.writer(output)
		CSVwriter.writerow([filename, label])


requiredFileName = {}

with open(datasetDetails, 'r') as fileNames:
	for name in fileNames:
		requiredFileName[name.split(",")[0]+".bytes"] = name.split(",")[1]

count1= 0
count2 = 0
limit = 50

for root, dirs, files in os.walk(datasetPath):
	for file in files:
		if file.endswith(".bytes"):
			#print(os.path.join(root,file))
#			print file
			if file in requiredFileName:
				print file
				if count1 == limit and count2 == limit:
					break
				elif requiredFileName[file].strip() == "0" and count1 < limit:
					count1 += 1
					shutil.copy2(os.path.join(root, file), outputPath)
					writeCSV(file, "0")
				elif requiredFileName[file].strip() == "1" and count2 < limit:
					count2 += 1
					shutil.copy2(os.path.join(root, file), outputPath)
					writeCSV(file, "1")
